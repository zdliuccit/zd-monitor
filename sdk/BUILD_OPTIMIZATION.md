# æ„å»ºä¼˜åŒ– - Terser å‹ç¼©é…ç½®

## ğŸ“Š å‹ç¼©æ•ˆæœå¯¹æ¯”

| ç‰ˆæœ¬ | æ–‡ä»¶å¤§å° | å‹ç¼©ç‡ | ç”¨é€” |
|------|----------|--------|------|
| å¼€å‘ç‰ˆæœ¬ | 59KB | - | å¼€å‘è°ƒè¯•ï¼ŒåŒ…å«source map |
| ç”Ÿäº§ç‰ˆæœ¬ï¼ˆUMDï¼‰ | 26KB | **-56%** | æµè§ˆå™¨ç›´æ¥å¼•å…¥ |
| ESMç‰ˆæœ¬ | 25KB | **-58%** | ç°ä»£æ„å»ºå·¥å…· |
| CommonJSç‰ˆæœ¬ | 26KB | **-56%** | Node.jsç¯å¢ƒ |

## âš™ï¸ Terser å‹ç¼©é…ç½®

### UMDç‰ˆæœ¬é…ç½®ï¼ˆé€‚åˆç”Ÿäº§ç¯å¢ƒï¼‰
```javascript
terser({
  compress: {
    drop_console: true,           // ç§»é™¤æ‰€æœ‰consoleè¯­å¥
    drop_debugger: true,         // ç§»é™¤debuggerè¯­å¥
    pure_funcs: ['console.log', 'console.warn'] // ç§»é™¤æŒ‡å®šå‡½æ•°è°ƒç”¨
  },
  mangle: {
    reserved: ['WebMonitorSDK']   // ä¿ç•™å…¨å±€å˜é‡åä¸è¢«æ··æ·†
  },
  format: {
    comments: false              // ç§»é™¤æ‰€æœ‰æ³¨é‡Š
  }
})
```

### ESM/CommonJSç‰ˆæœ¬é…ç½®ï¼ˆä¿ç•™è°ƒè¯•ä¿¡æ¯ï¼‰
```javascript
terser({
  compress: {
    drop_console: false,         // ä¿ç•™consoleï¼Œä¾¿äºè°ƒè¯•
    drop_debugger: true,        // ç§»é™¤debuggerè¯­å¥
    pure_funcs: ['console.debug'] // åªç§»é™¤debugçº§åˆ«æ—¥å¿—
  },
  mangle: true,                 // å˜é‡åæ··æ·†
  format: {
    comments: false             // ç§»é™¤æ³¨é‡Š
  }
})
```

## ğŸš€ æ„å»ºè„šæœ¬

```bash
# æ¸…ç†æ„å»ºç›®å½•å¹¶é‡æ–°æ„å»º
yarn build

# æ„å»ºå¹¶æŸ¥çœ‹æ–‡ä»¶å¤§å°åˆ†æ
yarn build:analyze

# åªæ¸…ç†æ„å»ºç›®å½•
yarn clean
```

## ğŸ“ˆ ä¼˜åŒ–æ•ˆæœ

### 1. ä½“ç§¯ä¼˜åŒ–
- **å˜é‡åæ··æ·†**: å°†é•¿å˜é‡åæ›¿æ¢ä¸ºçŸ­å­—ç¬¦ï¼Œå‡å°‘æ–‡ä»¶å¤§å°
- **æ­»ä»£ç æ¶ˆé™¤**: ç§»é™¤æœªä½¿ç”¨çš„ä»£ç åˆ†æ”¯
- **æ³¨é‡Šç§»é™¤**: æ¸…ç†æ‰€æœ‰æ³¨é‡Šå’Œç©ºç™½å­—ç¬¦
- **Consoleç§»é™¤**: ç”Ÿäº§ç‰ˆæœ¬ç§»é™¤è°ƒè¯•è¯­å¥

### 2. è¿è¡Œæ—¶ä¼˜åŒ–
- **å‡½æ•°å†…è”**: å°å‡½æ•°ç›´æ¥å†…è”åˆ°è°ƒç”¨å¤„
- **æ¡ä»¶ä¼˜åŒ–**: ç®€åŒ–å¸ƒå°”è¡¨è¾¾å¼å’Œæ¡ä»¶åˆ¤æ–­
- **å¾ªç¯ä¼˜åŒ–**: ä¼˜åŒ–å¾ªç¯ç»“æ„å’Œè¿­ä»£å™¨

### 3. å…¼å®¹æ€§ä¿è¯
- **ä¿ç•™å…³é”®API**: WebMonitorSDKç­‰å…³é”®æ ‡è¯†ç¬¦ä¸è¢«æ··æ·†
- **è¯­æ³•é™çº§**: ç¡®ä¿åœ¨ç›®æ ‡ç¯å¢ƒä¸­æ­£å¸¸è¿è¡Œ
- **é”™è¯¯å¤„ç†**: ä¿æŒåŸæœ‰çš„é”™è¯¯å¤„ç†é€»è¾‘

## ğŸ”§ è‡ªå®šä¹‰å‹ç¼©é…ç½®

å¦‚éœ€è°ƒæ•´å‹ç¼©é…ç½®ï¼Œä¿®æ”¹ `rollup.config.prod.js`:

```javascript
// æ›´æ¿€è¿›çš„å‹ç¼©ï¼ˆå¯èƒ½å½±å“è°ƒè¯•ï¼‰
terser({
  compress: {
    drop_console: true,
    drop_debugger: true,
    pure_funcs: ['console.log', 'console.warn', 'console.info'],
    unsafe: true,              // å¯ç”¨ä¸å®‰å…¨ä¼˜åŒ–
    unsafe_comps: true,        // ä¸å®‰å…¨çš„æ¯”è¾ƒä¼˜åŒ–
    unsafe_math: true,         // ä¸å®‰å…¨çš„æ•°å­¦ä¼˜åŒ–
    passes: 2                  // å¤šè½®ä¼˜åŒ–
  },
  mangle: {
    toplevel: true,            // æ··æ·†é¡¶çº§ä½œç”¨åŸŸ
    properties: true           // æ··æ·†å¯¹è±¡å±æ€§å
  }
})

// æ›´ä¿å®ˆçš„å‹ç¼©ï¼ˆä¿æŒå¯è¯»æ€§ï¼‰
terser({
  compress: {
    drop_console: false,       // ä¿ç•™console
    drop_debugger: false,      // ä¿ç•™debugger
    keep_fnames: true,         // ä¿ç•™å‡½æ•°å
    keep_classnames: true      // ä¿ç•™ç±»å
  },
  mangle: false,               // ä¸æ··æ·†å˜é‡å
  format: {
    comments: 'all',           // ä¿ç•™æ³¨é‡Š
    beautify: true             // ç¾åŒ–è¾“å‡º
  }
})
```

## ğŸ“‹ æœ€ä½³å®è·µ

### 1. å¼€å‘é˜¶æ®µ
- ä½¿ç”¨ `yarn dev` æ„å»ºå¼€å‘ç‰ˆæœ¬
- ä¿ç•™source mapå’Œè°ƒè¯•ä¿¡æ¯
- å®æ—¶ç›‘å¬æ–‡ä»¶å˜åŒ–

### 2. æµ‹è¯•é˜¶æ®µ
- ä½¿ç”¨ `yarn build` æ„å»ºå‹ç¼©ç‰ˆæœ¬
- åœ¨æµ‹è¯•é¡µé¢éªŒè¯åŠŸèƒ½å®Œæ•´æ€§
- æ£€æŸ¥å‹ç¼©åçš„APIè°ƒç”¨

### 3. ç”Ÿäº§éƒ¨ç½²
- ä½¿ç”¨UMDç‰ˆæœ¬ç›´æ¥åœ¨æµè§ˆå™¨ä¸­å¼•å…¥
- ä½¿ç”¨ESMç‰ˆæœ¬é…åˆç°ä»£æ„å»ºå·¥å…·
- ç›‘æ§å®é™…è¿è¡Œæ€§èƒ½

## ğŸ” å‹ç¼©éªŒè¯

éªŒè¯å‹ç¼©åçš„ä»£ç æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š

```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æµ‹è¯•
const monitor = new WebMonitorSDK.default({
  appId: 'test',
  reportUrl: 'https://httpbin.org/post',
  debug: true  // æ³¨æ„ï¼šUMDç‰ˆæœ¬ä¸­æ­¤é€‰é¡¹æ— æ•ˆï¼ˆconsoleè¢«ç§»é™¤ï¼‰
});

// æ£€æŸ¥æ ¸å¿ƒåŠŸèƒ½
monitor.reportError('Test error');
monitor.setUser('test-user');
console.log('Session ID:', monitor.getSessionId());
```

## ğŸ“Š Bundle åˆ†æå·¥å…·

æ¨èä½¿ç”¨ä»¥ä¸‹å·¥å…·åˆ†æbundleï¼š

```bash
# å®‰è£…bundleåˆ†æå·¥å…·
yarn add --dev rollup-plugin-analyzer

# æˆ–ä½¿ç”¨åœ¨çº¿å·¥å…·
# https://bundlephobia.com/ - æŸ¥çœ‹åŒ…å¤§å°
# https://webpack-bundle-analyzer.com/ - å¯è§†åŒ–åˆ†æ
```

è¿™ç§ä¼˜åŒ–ç­–ç•¥ç¡®ä¿äº†SDKåœ¨ä¿æŒåŠŸèƒ½å®Œæ•´æ€§çš„åŒæ—¶ï¼Œå¤§å¹…å‡å°‘äº†æ–‡ä»¶ä½“ç§¯ï¼Œæå‡äº†åŠ è½½æ€§èƒ½ã€‚