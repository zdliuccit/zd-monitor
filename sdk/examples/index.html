<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Monitor SDK - æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #eee;
            border-radius: 6px;
        }
        .section h2 {
            color: #666;
            margin-top: 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #0056b3;
        }
        button.danger {
            background: #dc3545;
        }
        button.danger:hover {
            background: #c82333;
        }
        input, textarea {
            width: 200px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 5px;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-top: 15px;
        }
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        .metric {
            background: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
        }
        .metric-name {
            font-weight: bold;
            color: #495057;
        }
        .metric-value {
            font-size: 18px;
            color: #007bff;
            margin-top: 5px;
        }
        .slow-resource {
            width: 100px;
            height: 100px;
            background: url('https://httpbin.org/delay/3') no-repeat;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Web Monitor SDK æµ‹è¯•é¡µé¢</h1>
        
        <div class="section">
            <h2>ğŸš€ æ€§èƒ½æµ‹è¯•</h2>
            <button onclick="loadLargeImage()">åŠ è½½å¤§å›¾ç‰‡</button>
            <button onclick="loadSlowResource()">åŠ è½½æ…¢èµ„æº</button>
            <button onclick="triggerLongTask()">è§¦å‘é•¿ä»»åŠ¡</button>
            <button onclick="causeLayoutShift()">å¼•èµ·å¸ƒå±€åç§»</button>
            <div class="slow-resource" id="slowResource" style="display: none;"></div>
        </div>

        <div class="section">
            <h2>âŒ é”™è¯¯æµ‹è¯•</h2>
            <button class="danger" onclick="throwJSError()">æŠ›å‡ºJSé”™è¯¯</button>
            <button class="danger" onclick="throwPromiseError()">Promiseé”™è¯¯</button>
            <button class="danger" onclick="loadBrokenImage()">åŠ è½½å¤±è´¥çš„å›¾ç‰‡</button>
            <button class="danger" onclick="makeFailedAPI()">å¤±è´¥çš„APIè¯·æ±‚</button>
            <button class="danger" onclick="reportCustomError()">è‡ªå®šä¹‰é”™è¯¯</button>
        </div>

        <div class="section">
            <h2>ğŸ‘¤ ç”¨æˆ·è¡Œä¸ºæµ‹è¯•</h2>
            <button onclick="trackCustomBehavior()">è‡ªå®šä¹‰è¡Œä¸º</button>
            <button onclick="changeRoute()">è·¯ç”±è·³è½¬</button>
            <input type="text" placeholder="è¾“å…¥æµ‹è¯•" />
            <textarea placeholder="æ–‡æœ¬åŒºåŸŸæµ‹è¯•"></textarea>
            <div style="height: 1000px; background: linear-gradient(to bottom, #ff7b7b, #7b7bff);">
                <p>æ»šåŠ¨æµ‹è¯•åŒºåŸŸ</p>
            </div>
        </div>

        <div class="section">
            <h2>âš™ï¸ SDKæ§åˆ¶</h2>
            <button onclick="setUserInfo()">è®¾ç½®ç”¨æˆ·ä¿¡æ¯</button>
            <button onclick="setTags()">è®¾ç½®æ ‡ç­¾</button>
            <button onclick="getSDKInfo()">è·å–SDKä¿¡æ¯</button>
            <button onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
        </div>

        <div class="section">
            <h2>ğŸ“Š å®æ—¶æŒ‡æ ‡</h2>
            <div class="metrics" id="metrics">
                <!-- åŠ¨æ€ç”ŸæˆæŒ‡æ ‡ -->
            </div>
        </div>

        <div class="section">
            <h2>ğŸ“ æ—¥å¿—è¾“å‡º</h2>
            <div class="log" id="log"></div>
        </div>
    </div>

    <!-- åŠ è½½SDK -->
    <script src="../dist/web-monitor-sdk.dev.js"></script>
    
    <script>
        // åˆå§‹åŒ–SDK
        let sdk;
        try {
            sdk = new WebMonitorSDK.default({
                appId: 'test-app-123',
                reportUrl: 'https://httpbin.org/post', // æµ‹è¯•ç”¨çš„æ¥æ”¶ç«¯ç‚¹
                debug: true,
                sampling: 1,
                enablePerformance: true,
                enableError: true,
                enableBehavior: true,
                beforeSend: (data) => {
                    logMessage('ğŸ“¤ å³å°†å‘é€æ•°æ®:', data);
                    return data;
                }
            });

            // ä½¿ç”¨Vueæ’ä»¶ç¤ºä¾‹
            // sdk.use(WebMonitorSDK.VuePlugin);
            
            logMessage('âœ… SDKåˆå§‹åŒ–æˆåŠŸ');
        } catch (error) {
            logMessage('âŒ SDKåˆå§‹åŒ–å¤±è´¥:', error);
        }

        // æ—¥å¿—å‡½æ•°
        function logMessage(message, data = null) {
            const log = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            
            if (data) {
                logEntry.innerHTML = `<span style="color: #666;">[${time}]</span> ${message}<br/><pre style="margin: 5px 0; color: #007bff;">${JSON.stringify(data, null, 2)}</pre>`;
            } else {
                logEntry.innerHTML = `<span style="color: #666;">[${time}]</span> ${message}`;
            }
            
            log.appendChild(logEntry);
            log.scrollTop = log.scrollHeight;
        }

        // æ€§èƒ½æµ‹è¯•å‡½æ•°
        function loadLargeImage() {
            const img = new Image();
            img.onload = () => logMessage('ğŸ–¼ï¸ å¤§å›¾ç‰‡åŠ è½½å®Œæˆ');
            img.onerror = () => logMessage('âŒ å¤§å›¾ç‰‡åŠ è½½å¤±è´¥');
            img.src = 'https://picsum.photos/2000/2000?' + Math.random();
        }

        function loadSlowResource() {
            document.getElementById('slowResource').style.display = 'block';
            logMessage('â³ å¼€å§‹åŠ è½½æ…¢èµ„æº...');
        }

        function triggerLongTask() {
            logMessage('â±ï¸ å¼€å§‹æ‰§è¡Œé•¿ä»»åŠ¡...');
            const start = performance.now();
            // æ¨¡æ‹Ÿé•¿ä»»åŠ¡
            while (performance.now() - start < 100) {
                Math.random();
            }
            logMessage('âœ… é•¿ä»»åŠ¡æ‰§è¡Œå®Œæˆ');
        }

        function causeLayoutShift() {
            const div = document.createElement('div');
            div.style.cssText = 'height: 200px; background: red; margin: 10px 0;';
            div.textContent = 'è¿™æ˜¯ä¸€ä¸ªåŠ¨æ€æ’å…¥çš„å…ƒç´ ï¼Œä¼šå¼•èµ·å¸ƒå±€åç§»';
            document.body.insertBefore(div, document.querySelector('.container'));
            
            setTimeout(() => {
                div.remove();
            }, 2000);
            
            logMessage('ğŸ“ è§¦å‘äº†å¸ƒå±€åç§»');
        }

        // é”™è¯¯æµ‹è¯•å‡½æ•°
        function throwJSError() {
            throw new Error('è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•çš„JavaScripté”™è¯¯');
        }

        function throwPromiseError() {
            Promise.reject(new Error('è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•çš„Promiseé”™è¯¯'));
        }

        function loadBrokenImage() {
            const img = new Image();
            img.src = 'https://non-existent-domain-12345.com/image.jpg';
            document.body.appendChild(img);
            logMessage('ğŸ–¼ï¸ å°è¯•åŠ è½½å¤±è´¥çš„å›¾ç‰‡');
        }

        function makeFailedAPI() {
            fetch('https://httpbin.org/status/500')
                .then(response => {
                    if (!response.ok) {
                        logMessage('âŒ APIè¯·æ±‚è¿”å›é”™è¯¯çŠ¶æ€ç ');
                    }
                })
                .catch(error => {
                    logMessage('âŒ APIè¯·æ±‚å¤±è´¥:', error.message);
                });
        }

        function reportCustomError() {
            if (sdk) {
                sdk.reportError('è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰é”™è¯¯', { 
                    category: 'test',
                    level: 'high',
                    extra: { userId: '123', action: 'button_click' }
                });
                logMessage('ğŸ“ ä¸ŠæŠ¥äº†è‡ªå®šä¹‰é”™è¯¯');
            }
        }

        // è¡Œä¸ºæµ‹è¯•å‡½æ•°
        function trackCustomBehavior() {
            if (sdk) {
                sdk.reportBehavior('custom_button_click', {
                    buttonName: 'è‡ªå®šä¹‰è¡Œä¸ºæŒ‰é’®',
                    location: 'test_page'
                });
                logMessage('ğŸ‘† è®°å½•äº†è‡ªå®šä¹‰è¡Œä¸º');
            }
        }

        function changeRoute() {
            history.pushState({}, '', location.pathname + '?test=' + Date.now());
            logMessage('ğŸ”„ è§¦å‘äº†è·¯ç”±å˜åŒ–');
        }

        // SDKæ§åˆ¶å‡½æ•°
        function setUserInfo() {
            if (sdk) {
                sdk.setUser('user_' + Date.now(), {
                    name: 'æµ‹è¯•ç”¨æˆ·',
                    email: 'test@example.com'
                });
                logMessage('ğŸ‘¤ è®¾ç½®äº†ç”¨æˆ·ä¿¡æ¯');
            }
        }

        function setTags() {
            if (sdk) {
                sdk.setTag('environment', 'test');
                sdk.setTag('version', '1.0.0');
                logMessage('ğŸ·ï¸ è®¾ç½®äº†æ ‡ç­¾');
            }
        }

        function getSDKInfo() {
            if (sdk) {
                const info = {
                    sessionId: sdk.getSessionId(),
                    userId: sdk.getUserId(),
                    config: sdk.getConfig()
                };
                logMessage('â„¹ï¸ SDKä¿¡æ¯:', info);
            }
        }

        function clearLogs() {
            document.getElementById('log').innerHTML = '';
        }

        // å®æ—¶æŒ‡æ ‡æ›´æ–°
        function updateMetrics() {
            const metricsContainer = document.getElementById('metrics');
            const metrics = {
                'ä¼šè¯ID': sdk ? sdk.getSessionId() : 'N/A',
                'ç”¨æˆ·ID': sdk ? sdk.getUserId() : 'N/A',
                'å½“å‰URL': location.href,
                'é¡µé¢åŠ è½½æ—¶é—´': performance.timing ? (performance.timing.loadEventEnd - performance.timing.navigationStart) + 'ms' : 'N/A',
                'å†…å­˜ä½¿ç”¨': performance.memory ? Math.round(performance.memory.usedJSHeapSize / 1024 / 1024) + 'MB' : 'N/A',
                'è¿æ¥ç±»å‹': navigator.connection ? navigator.connection.effectiveType : 'Unknown'
            };

            metricsContainer.innerHTML = Object.entries(metrics)
                .map(([name, value]) => `
                    <div class="metric">
                        <div class="metric-name">${name}</div>
                        <div class="metric-value">${value}</div>
                    </div>
                `).join('');
        }

        // æ¯5ç§’æ›´æ–°ä¸€æ¬¡æŒ‡æ ‡
        setInterval(updateMetrics, 5000);
        updateMetrics();

        // ç›‘å¬æ‰€æœ‰ç‚¹å‡»äº‹ä»¶
        document.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                logMessage('ğŸ‘† ç‚¹å‡»äº†æŒ‰é’®: ' + (e.target.textContent || 'Unknown'));
            }
        });

        // ç›‘å¬é”™è¯¯
        window.addEventListener('error', (e) => {
            logMessage('âŒ æ•è·åˆ°å…¨å±€é”™è¯¯: ' + e.message);
        });

        window.addEventListener('unhandledrejection', (e) => {
            logMessage('âŒ æ•è·åˆ°Promiseé”™è¯¯: ' + e.reason);
        });

        logMessage('ğŸ‰ æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
    </script>
</body>
</html>