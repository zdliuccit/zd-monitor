<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue Integration - Web Monitor SDK</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #333; text-align: center; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #eee; border-radius: 6px; }
        button {
            background: #42b883;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #369870; }
        button.danger { background: #e74c3c; }
        button.danger:hover { background: #c0392b; }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <h1>{{ title }}</h1>
            
            <div class="section">
                <h2>Vueç»„ä»¶æµ‹è¯•</h2>
                <p>å½“å‰è®¡æ•°: {{ count }}</p>
                <button @click="increment">å¢åŠ è®¡æ•°</button>
                <button @click="reset">é‡ç½®è®¡æ•°</button>
            </div>

            <div class="section">
                <h2>Vueé”™è¯¯æµ‹è¯•</h2>
                <button class="danger" @click="throwError">æŠ›å‡ºç»„ä»¶é”™è¯¯</button>
                <button class="danger" @click="throwAsyncError">æŠ›å‡ºå¼‚æ­¥é”™è¯¯</button>
                <button class="danger" @click="triggerComputedError">è§¦å‘è®¡ç®—å±æ€§é”™è¯¯</button>
            </div>

            <div class="section">
                <h2>åŠ¨æ€ç»„ä»¶</h2>
                <button @click="showComponent = !showComponent">
                    {{ showComponent ? 'éšè—' : 'æ˜¾ç¤º' }}åŠ¨æ€ç»„ä»¶
                </button>
                <error-component v-if="showComponent"></error-component>
            </div>

            <div class="section">
                <h2>æ—¥å¿—è¾“å‡º</h2>
                <button @click="clearLogs">æ¸…ç©ºæ—¥å¿—</button>
                <div class="log" ref="log" v-html="logs"></div>
            </div>
        </div>
    </div>

    <!-- Vue 2.x -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <!-- SDK -->
    <script src="../dist/web-monitor-sdk.dev.js"></script>

    <script>
        // é”™è¯¯ç»„ä»¶
        Vue.component('error-component', {
            template: `
                <div style="padding: 10px; border: 1px solid #ddd; margin: 10px 0;">
                    <h3>åŠ¨æ€ç»„ä»¶</h3>
                    <p>è¿™æ˜¯ä¸€ä¸ªå¯èƒ½å‡ºé”™çš„ç»„ä»¶</p>
                    <button @click="causeError" class="danger">åœ¨ç»„ä»¶å†…è§¦å‘é”™è¯¯</button>
                </div>
            `,
            methods: {
                causeError() {
                    // æ•…æ„è®¿é—®ä¸å­˜åœ¨çš„å±æ€§
                    this.nonExistentProperty.someMethod();
                }
            }
        });

        // åˆå§‹åŒ–SDK
        const sdk = new WebMonitorSDK.default({
            appId: 'vue-test-app',
            reportUrl: 'https://httpbin.org/post',
            debug: true,
            sampling: 1,
            beforeSend: (data) => {
                app.logMessage('ğŸ“¤ SDKå‘é€æ•°æ®:', data);
                return data;
            }
        });

        // ä½¿ç”¨Vueæ’ä»¶
        sdk.use(WebMonitorSDK.VuePlugin);

        // Vueåº”ç”¨
        const app = new Vue({
            el: '#app',
            data: {
                title: 'Vue + Web Monitor SDK é›†æˆæµ‹è¯•',
                count: 0,
                showComponent: false,
                logs: ''
            },
            computed: {
                errorComputed() {
                    if (this.count > 10) {
                        // æ•…æ„æŠ›å‡ºé”™è¯¯
                        throw new Error('è®¡ç®—å±æ€§ä¸­çš„é”™è¯¯ï¼šcount > 10');
                    }
                    return this.count * 2;
                }
            },
            methods: {
                increment() {
                    this.count++;
                    this.logMessage(`ğŸ”¢ è®¡æ•°å¢åŠ åˆ°: ${this.count}`);
                    
                    // è§¦å‘è®¡ç®—å±æ€§é”™è¯¯
                    if (this.count > 10) {
                        try {
                            const computed = this.errorComputed;
                        } catch (error) {
                            // é”™è¯¯ä¼šè¢«Vueé”™è¯¯å¤„ç†å™¨æ•è·
                        }
                    }
                },
                
                reset() {
                    this.count = 0;
                    this.logMessage('ğŸ”„ è®¡æ•°å·²é‡ç½®');
                },
                
                throwError() {
                    // åœ¨Vueæ–¹æ³•ä¸­æŠ›å‡ºé”™è¯¯
                    throw new Error('è¿™æ˜¯Vueç»„ä»¶æ–¹æ³•ä¸­çš„é”™è¯¯');
                },
                
                throwAsyncError() {
                    // å¼‚æ­¥é”™è¯¯
                    setTimeout(() => {
                        throw new Error('è¿™æ˜¯Vueç»„ä»¶ä¸­çš„å¼‚æ­¥é”™è¯¯');
                    }, 100);
                },
                
                triggerComputedError() {
                    this.count = 15; // è§¦å‘è®¡ç®—å±æ€§é”™è¯¯
                },
                
                logMessage(message, data = null) {
                    const time = new Date().toLocaleTimeString();
                    let logEntry = `<div><span style="color: #666;">[${time}]</span> ${message}`;
                    
                    if (data) {
                        logEntry += `<br/><pre style="margin: 5px 0; color: #007bff; font-size: 10px;">${JSON.stringify(data, null, 2)}</pre>`;
                    }
                    
                    logEntry += '</div>';
                    this.logs += logEntry;
                    
                    // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
                    this.$nextTick(() => {
                        const logEl = this.$refs.log;
                        if (logEl) {
                            logEl.scrollTop = logEl.scrollHeight;
                        }
                    });
                },
                
                clearLogs() {
                    this.logs = '';
                }
            },
            
            mounted() {
                this.logMessage('âœ… Vueåº”ç”¨å·²æŒ‚è½½');
                this.logMessage('ğŸ”Œ Vueæ’ä»¶å·²é›†æˆ');
                
                // è®¾ç½®ç”¨æˆ·ä¿¡æ¯
                sdk.setUser('vue-user-' + Date.now(), {
                    framework: 'Vue.js',
                    version: Vue.version
                });
            },
            
            errorCaptured(err, instance, info) {
                this.logMessage(`âŒ Vueé”™è¯¯è¾¹ç•Œæ•è·: ${err.message}`, {
                    error: err.message,
                    component: instance.$options.name || 'Anonymous',
                    info: info
                });
                
                // è¿”å›falseé˜»æ­¢é”™è¯¯ç»§ç»­ä¼ æ’­
                return false;
            }
        });

        // ç›‘å¬å…¨å±€é”™è¯¯
        window.addEventListener('error', (e) => {
            app.logMessage('âŒ å…¨å±€é”™è¯¯: ' + e.message);
        });

        window.addEventListener('unhandledrejection', (e) => {
            app.logMessage('âŒ Promiseé”™è¯¯: ' + e.reason);
        });

        app.logMessage('ğŸ‰ Vueæµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
    </script>
</body>
</html>